<!DOCTYPE html>
<html>
	<head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>

		<script src="//treetopflyer.github.com/vcore/lib.js"></script>
        <script src="//treetopflyer.github.com/rasterizer/lib.js"></script>

        <script src="rbm.js"></script>
        
	</head>
	<body>
        
        <img class="ts1 1_1" src="ts2_L_1.png"/>
        <img class="ts1 1_2" src="ts2_L_2.png"/>
        <img class="ts1 1_3" src="ts2_L_3.png"/>
        
        <img class="ts1 2_1" src="ts2_E_1.png"/>
        <img class="ts1 2_2" src="ts2_E_2.png"/>
        <img class="ts1 2_3" src="ts2_E_3.png"/>
        
        <img class="ts1 3_1" src="ts1_1_1.png"/>
        <img class="ts1 3_2" src="ts1_1_2.png"/>
        <img class="ts1 3_3" src="ts1_1_3.png"/>
        <img class="ts1 3_4" src="ts1_1_4.png"/>
        
        <img class="ts1 4_1" src="ts1_2_1.png"/>
        <img class="ts1 4_2" src="ts1_2_2.png"/>
        <img class="ts1 4_3" src="ts1_2_3.png"/>
        <img class="ts1 4_4" src="ts1_2_4.png"/>
        
        <br/>
        <br/>
        
        <canvas width="30" height="30"></canvas>
        


        <script>
            
            Rasterizer.ArrayRead = function(inRasterizer)
            {
                var out = [];
                Rasterizer.Iterate(inRasterizer, function(inMathX, inMathY, inScreenX, inScreenY)
                {
                    var data = inRasterizer.Canvas.getImageData(inScreenX, inScreenY, 1, 1).data;

                    out.push(data[0]/255);

                    /*
                    if(data[0] > 100)
                        out.push(1);
                    else
                        out.push(0);
                    */
                });
                return out;
            };
            Rasterizer.ArrayWrite = function(inRasterizer, inArray, inBias)
            {
                var counter = -1;
                var brightness;
                Rasterizer.Iterate(inRasterizer, function(inMathX, inMathY, inScreenX, inScreenY)
                {
                    counter++;
                    brightness = inArray[counter] + inBias;
                    
                    return [brightness, brightness, brightness];
                });
            };
            
            
            var ras = Rasterizer.CreateFrom($("canvas").eq(0));
            var training = [];
            var rbm = RBM.Create(900, 5);


            function go()
            {
                Rasterizer.Bake(ras, $("img.1_1"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.1_2"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.1_3"));
                training.push(Rasterizer.ArrayRead(ras));
                
                Rasterizer.Bake(ras, $("img.2_1"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.2_2"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.2_3"));
                training.push(Rasterizer.ArrayRead(ras));
                
                Rasterizer.Bake(ras, $("img.3_1"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.3_2"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.3_3"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.3_4"));
                training.push(Rasterizer.ArrayRead(ras));
                
                Rasterizer.Bake(ras, $("img.4_1"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.4_2"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.4_3"));
                training.push(Rasterizer.ArrayRead(ras));
                Rasterizer.Bake(ras, $("img.4_4"));
                training.push(Rasterizer.ArrayRead(ras));
            
            
                RBM.Train(rbm, training, 1000, 1, 0.001);
                console.log(RBM.Label(rbm, training));
            }
            
            //RBM.Train(rbm, training, 500, 2, 0.2);
            //console.log("training done!");
            
            //Rasterizer.ArrayWrite(ras, rbm.MatrixForward[0], 0.5);
            //Rasterizer.ArrayWrite(ras, M.Sigmoid([rbm.MatrixForward[0]])[0], 0.0);
            //Rasterizer.ArrayWrite(ras, RBM.Observe(rbm, [training[0]], 1)[0], 0.0);
            
            
        </script>

<script>
var DatApp = angular.module("DatApp", []);
DatApp.factory("Files", [function()
{
    var arr = [];

    arr.push("ts2_L_1.png");
    arr.push("ts2_L_2.png");
    arr.push("ts2_L_3.png");
        
    arr.push("ts2_E_1.png");
    arr.push("ts2_E_2.png");
    arr.push("ts2_E_3.png");
        
    arr.push("ts1_1_1.png");
    arr.push("ts1_1_2.png");
    arr.push("ts1_1_3.png");
    arr.push("ts1_1_4.png");
        
    arr.push("ts1_2_1.png");
    arr.push("ts1_2_2.png");
    arr.push("ts1_2_3.png");
    arr.push("ts1_2_4.png");

    return arr;
}]);
DatApp.factory("Load", [function()
{
    var obj = {};
    obj.Image = function()
    {
        var img;
        img = new Image();
        img.onload = function()
        {

        };
    };
    return obj;
}]);
DatApp.controller("DatAppController", ["$scope", "Files", function($scope, Files)
{
    $scope.Images = Files;
}]);
</script>

	</body>
</html>